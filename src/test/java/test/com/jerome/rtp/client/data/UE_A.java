package test.com.jerome.rtp.client.data;import java.io.IOException;import java.net.InetSocketAddress;import java.net.SocketAddress;import org.glassfish.grizzly.filterchain.BaseFilter;import org.glassfish.grizzly.filterchain.FilterChainBuilder;import org.glassfish.grizzly.filterchain.FilterChainContext;import org.glassfish.grizzly.filterchain.NextAction;import org.glassfish.grizzly.filterchain.TransportFilter;import org.glassfish.grizzly.nio.transport.UDPNIOTransport;import org.glassfish.grizzly.nio.transport.UDPNIOTransportBuilder;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import test.com.jerome.rtp.data.DataPacketTest;import com.jerome.rtp.protocol.data.DataPacket;import com.jerome.rtp.protocol.data.SimpleDataPacket;import com.jerome.rtp.protocol.parse.DataParse;import com.jerome.rtp.protocol.utils.ByteUtils;public class UE_A {	private final static Logger logger = LoggerFactory.getLogger(UE_A.class);		public static void main(String[] args) throws Exception {		byte[] packetBytes = ByteUtils.convertHexStringToByteArray(DataPacketTest.H263_PACKET);		FilterChainBuilder filterChainBuilder = FilterChainBuilder.stateless();		filterChainBuilder.add(new TransportFilter());		filterChainBuilder.add(new DataParse());		filterChainBuilder.add(new ClientFilter(packetBytes));		final UDPNIOTransport transport = UDPNIOTransportBuilder.newInstance().build();		transport.setProcessor(filterChainBuilder.build());		transport.bind(6002);		transport.start();		InetSocketAddress local = new InetSocketAddress("127.0.0.1", 6002);		SocketAddress rm = new InetSocketAddress("127.0.0.1", 5000);		while(true){			transport.connect(rm, local);			Thread.sleep(100);		}		//		System.in.read();	}	static class ClientFilter extends BaseFilter {		private final byte[] packetBytes;		public ClientFilter(byte[] packetBytes) {			this.packetBytes = packetBytes;		}		@Override		public NextAction handleConnect(final FilterChainContext ctx) throws IOException {			DataPacket decode = SimpleDataPacket.decode(packetBytes);			InetSocketAddress localAddress = (InetSocketAddress) ctx.getConnection().getLocalAddress();			InetSocketAddress remoteAddress = (InetSocketAddress) ctx.getConnection().getPeerAddress();			logger.debug("Receive Address: Control Source={} Destination={}",localAddress,remoteAddress);			ctx.write(decode);			return ctx.getInvokeAction();		}		@Override		public NextAction handleRead(final FilterChainContext ctx) throws IOException {			DataPacket packet = (DataPacket) ctx.getMessage();			logger.info("Receive : Data PT={},SSRC={},", packet.getPayloadType(), packet.getSsrc());			return ctx.getInvokeAction();		}	}}